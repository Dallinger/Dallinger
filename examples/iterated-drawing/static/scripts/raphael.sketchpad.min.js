/*
 * Raphael SketchPad
 * Version 0.5.1
 * Copyright (c) 2011 Ian Li (http://ianli.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
function hoozit(a){return a.constructor===String?"string":a.constructor===Boolean?"boolean":a.constructor===Number?isNaN(a)?"nan":"number":"undefined"==typeof a?"undefined":null===a?"null":a instanceof Array?"array":a instanceof Date?"date":a instanceof RegExp?"regexp":"object"==typeof a?"object":a instanceof Function?"function":void 0}function bindCallbacks(a,b,c){var d=hoozit(a);return d?"function"===hoozit(b[d])?b[d].apply(b,c):b[d]:void 0}!function(a){a.sketchpad=function(a,c){return new b(a,c)},a.sketchpad.VERSION="0.5.1";var b=function(b,e){function l(a){for(var b="",c=0,d=a.length;d>c;c++){var e=a[c];b+=e[0]+e[1]+","+e[2]}return b}function m(a){var b=[],c=a.split("L");if(c.length>0){var d=c[0].replace("M",""),e=d.split(",");b.push(["M",parseInt(e[0]),parseInt(e[1])]);for(var f=1,g=c.length;g>f;f++)d=c[f],e=d.split(","),b.push(["L",parseInt(e[0]),parseInt(e[1])])}return b}function o(){n()}function p(){h.clear();for(var a=0,b=A.length;b>a;a++){var c=A[a],d=c.type;h[d]().attr(c).click(s)}}function q(){$("*").css("-webkit-user-select","none"),$("*").css("-moz-user-select","none"),jQuery.browser.msie&&$("body").attr("onselectstart","return false;")}function r(){$("*").css("-webkit-user-select","text"),$("*").css("-moz-user-select","text"),jQuery.browser.msie&&$("body").removeAttr("onselectstart")}function s(a){if("erase"==g.editing){var b=this.attr();b.type=this.type,z.add({type:"erase",stroke:b});for(var c=0,d=A.length;d>c;c++){var e=A[c];equiv(e,b)&&A.splice(c,1)}o(),this.remove()}}function t(a){q(),k.start(a,f)}function u(a){k.move(a,f)}function v(a){r();var b=k.finish(a,f);if(null!=b){b.click(s);var c=b.attr();c.type=b.type,A.push(c),z.add({type:"stroke",stroke:c}),o()}}function w(a){if(a=a.originalEvent,a.preventDefault(),1==a.touches.length){var b=a.touches[0];t(b)}}function x(a){if(a=a.originalEvent,a.preventDefault(),1==a.touches.length){var b=a.touches[0];u(b)}}function y(a){a=a.originalEvent,a.preventDefault(),v(a)}var f=this,g={width:100,height:100,strokes:[],editing:!0};jQuery.extend(g,e);var h;if(b.raphael&&b.raphael.constructor==a.constructor)h=b;else{if("string"!=typeof b)throw"first argument must be a Raphael object, an element ID, an array with 3 elements";h=a(b,g.width,g.height)}var i=h.canvas,j=$(i).parent(),k=new d;f.paper=function(){return h},f.canvas=function(){return i},f.container=function(){return j},f.pen=function(a){return void 0===a?k:(k=a,f)},f.json=function(a){if(void 0===a){for(var b=0,c=A.length;c>b;b++){var d=A[b];"object"==typeof d.path&&(d.path=l(d.path))}return JSON.stringify(A)}return f.strokes(JSON.parse(a))},f.strokes=function(a){if(void 0===a)return A;if(jQuery.isArray(a)){A=a;for(var b=0,c=A.length;c>b;b++){var d=A[b];"string"==typeof d.path&&(d.path=m(d.path))}z.add({type:"batch",strokes:jQuery.merge([],A)}),p(),o()}return f},f.freeze_history=function(){z.freeze()},f.undoable=function(){return z.undoable()},f.undo=function(){return z.undoable()&&(z.undo(),A=z.current_strokes(),p(),o()),f},f.redoable=function(){return z.redoable()},f.redo=function(){return z.redoable()&&(z.redo(),A=z.current_strokes(),p(),o()),f},f.clear=function(){return z.add({type:"clear"}),A=[],p(),o(),f},f.animate=function(a){function c(){var d=A[b],e=d.type;h[e]().attr(d).click(s),b++,b<A.length&&setTimeout(c,a)}if(void 0===a&&(a=500),h.clear(),A.length>0){var b=0;c()}return f},f.editing=function(a){if(void 0===a)return g.editing;if(g.editing=a,g.editing)if("erase"==g.editing){$(j).css("cursor","crosshair"),$(j).unbind("mousedown",t),$(j).unbind("mousemove",u),$(j).unbind("mouseup",v),$(document).unbind("mouseup",v);var b=navigator.userAgent;(b.indexOf("iPhone")>0||b.indexOf("iPod")>0)&&($(j).unbind("touchstart",w),$(j).unbind("touchmove",x),$(j).unbind("touchend",y))}else{$(j).css("cursor","crosshair"),$(j).mousedown(t),$(j).mousemove(u),$(j).mouseup(v),$(document).mouseup(v);var b=navigator.userAgent;(b.indexOf("iPhone")>0||b.indexOf("iPod")>0)&&($(j).bind("touchstart",w),$(j).bind("touchmove",x),$(j).bind("touchend",y))}else{$(j).attr("style","cursor:default"),$(j).unbind("mousedown",t),$(j).unbind("mousemove",u),$(j).unbind("mouseup",v),$(document).unbind("mouseup",v);var b=navigator.userAgent;(b.indexOf("iPhone")>0||b.indexOf("iPod")>0)&&($(j).unbind("touchstart",w),$(j).unbind("touchmove",x),$(j).unbind("touchend",y))}return f};var n=function(){};f.change=function(a){null==a||void 0===a?n=function(){}:"function"==typeof a&&(n=a)};var z=new c,A=g.strokes;jQuery.isArray(A)&&A.length>0?(z.add({type:"init",strokes:jQuery.merge([],A)}),p()):(A=[],p()),f.editing(g.editing)},c=function(){var a=this,b=[],c=-1,d=-1,e=null;a.add=function(a){c+1<b.length&&b.splice(c+1,b.length-(c+1)),b.push(a),c=b.length-1,e=null},a.freeze=function(a){d=void 0===a?c:a},a.undoable=function(){return c>-1&&c>d},a.undo=function(){a.undoable()&&(c--,e=null)},a.redoable=function(){return c<b.length-1},a.redo=function(){a.redoable()&&(c++,e=null)},a.current_strokes=function(){if(null==e){for(var a=[],d=0;c>=d;d++){var f=b[d];switch(f.type){case"init":case"json":case"strokes":case"batch":jQuery.merge(a,f.strokes);break;case"stroke":a.push(f.stroke);break;case"erase":for(var g=0,h=a.length;h>g;g++){var i=a[g];equiv(i,f.stroke)&&a.splice(g,1)}break;case"clear":a=[]}}e=a}return e}},d=function(){function j(){if(null!=i&&i.length>1){for(var a=i[0],b="M"+a[0]+","+a[1],c=1,d=i.length;d>c;c++)a=i[c],b+="L"+a[0]+","+a[1];return b}return""}var a=this,b="#000000",c=1,e=5,f=null,g=!1,h=null,i=[];a.color=function(c){return void 0===c?b:(b=c,a)},a.width=function(b){return void 0===b?e:(b<d.MIN_WIDTH?b=d.MIN_WIDTH:b>d.MAX_WIDTH&&(b=d.MAX_WIDTH),e=b,a)},a.opacity=function(b){return void 0===b?c:(0>b?b=0:b>1&&(b=1),c=b,a)},a.start=function(a,d){g=!0,f=$(d.container()).offset();var j=a.pageX-f.left,k=a.pageY-f.top;i.push([j,k]),h=d.paper().path(),h.attr({stroke:b,"stroke-opacity":c,"stroke-width":e,"stroke-linecap":"round","stroke-linejoin":"round"})},a.finish=function(a,b){var c=null;return null!=h&&(i.length<=1?h.remove():c=h),g=!1,h=null,i=[],c},a.move=function(a,b){if(1==g){var c=a.pageX-f.left,d=a.pageY-f.top;i.push([c,d]),h.attr({path:j()})}}};d.MAX_WIDTH=1e3,d.MIN_WIDTH=1}(window.Raphael),Raphael.fn.display=function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b],e=d.type;this[e]().attr(d)}};var equiv=function(){var a,b=[],c=function(){function c(a,b){return a instanceof b.constructor||b instanceof a.constructor?b==a:b===a}return{string:c,"boolean":c,number:c,"null":c,undefined:c,nan:function(a){return isNaN(a)},date:function(a,b){return"date"===hoozit(a)&&b.valueOf()===a.valueOf()},regexp:function(a,b){return"regexp"===hoozit(a)&&b.source===a.source&&b.global===a.global&&b.ignoreCase===a.ignoreCase&&b.multiline===a.multiline},"function":function(){var a=b[b.length-1];return a!==Object&&"undefined"!=typeof a},array:function(b,c){var d,e;if("array"!==hoozit(b))return!1;if(e=c.length,e!==b.length)return!1;for(d=0;e>d;d++)if(!a(c[d],b[d]))return!1;return!0},object:function(c,d){var e,f=!0,g=[],h=[];if(d.constructor!==c.constructor)return!1;b.push(d.constructor);for(e in d)g.push(e),a(d[e],c[e])||(f=!1);b.pop();for(e in c)h.push(e);return f&&a(g.sort(),h.sort())}}}();return a=function(){var a=Array.prototype.slice.apply(arguments);return a.length<2?!0:function(a,b){return a===b?!0:null===a||null===b||"undefined"==typeof a||"undefined"==typeof b||hoozit(a)!==hoozit(b)?!1:bindCallbacks(a,c,[b,a])}(a[0],a[1])&&arguments.callee.apply(this,a.splice(1,a.length-1))}}();
